model Bool

model bool {
    return : Bool
    string : string    
    (&&) : bool -> bool
    (||) : bool -> bool
    (=>) : bool -> bool
    not  : bool
    (?)  : [c] c -> c -> c
}

type Try [a] {
    model Success { _ : a }
    model Failure { _ : string }
}

class try[a] this:Try[a] {
    map     : [b] (a -> b) -> try[b]
    flatmap : [b] (a -> try[b]) -> try[b]
    filter  : (a -> bool) -> try[a]
    recoverWith : a -> a
} {
    def Failure[a].map f = try $ Failure this._
    def Success[a].map f = try $ Success $ f this._

    def Failure[a].flatmap f = try $ Failure this._
    def Success[a].flatmap f = f this._

    def Failure[a].filter _ = self
    def Success[a].filter p = 
        let filtered = p this._ in
            filtered ? this $ self $ Failure "Filter fails"

    def Failure[a].recoverWith a = a
    def Success[a].recoverWith _ = this._
}
